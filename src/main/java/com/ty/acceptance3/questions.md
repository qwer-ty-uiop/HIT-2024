# 丢包出现死锁

## 为什么会死锁？

- 超时重传传输: 提前清理cancel的timer
- 返回的ACK: 出现 seq 大于窗口的情况，发现是因为ACK构造时出现错误，再追溯发现是send的ACK出现问题
- 发送窗口的处理逻辑: 用的是基于偏移量的，但是移动的时候窗口中的偏移量都会改变，导致了死锁
- 接收窗口的处理逻辑: receiveBase的逻辑有点混淆
- 发送数据的seqNum: 逻辑混淆

## 传输不完全

- timer中重新传输，用到了会随时间改变的变量baseIndex，所以找的数据不对
- 不是fileOutputStream的问题，不需要开启append
- 猜测是receive中的按序写入出现问题，没找出错误；后续找出错误，是receiveBase的范围设置错误
- 发送方超时重传没有问题，数据是对应的
- 接收方少写9行
    - 是否和丢包有关: 没关系
    - 还是与写入数有关，receiveBase的范围没有改